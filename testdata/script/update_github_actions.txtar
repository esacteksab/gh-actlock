exec actlock -u

# Check stderr for expected logs (using regex for robustness)
stdout 'ðŸ”§  Authenticated GitHub API access in effect.'

# Compare the modified file (in $WORK) with the expected output (also in $WORK)
cmp .github/workflows/test.yml expected.yml


# Setup initial workflow file relative to the temp $WORK dir
-- .github/workflows/test.yml --
name: Test Workflow
on: push
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout v4 (branch/tag)
        uses: actions/checkout@v4 # Known tag/branch
      - name: Setup Go v5 (branch/tag)
        uses: actions/setup-go@v5 # Known tag/vX tag
      - name: Action with specific SHA (should not change)
        uses: actions/checkout@a5ac7e51b41094c92402da3b24376905380afc29
      - name: Non-existent ref
        uses: actions/checkout@vNonExistentTag123
-- expected.yml --
name: Test Workflow
on: push
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout v4 (branch/tag)
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8  # v5.0.0
      - name: Setup Go v5 (branch/tag)
        uses: actions/setup-go@44694675825211faa026b3c33043df3e48a5fa00  # v6.0.0
      - name: Action with specific SHA (should not change)
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8  # v5.0.0
      - name: Non-existent ref
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8  # v5.0.0
